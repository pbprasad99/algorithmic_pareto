
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Personal Website">
      
      
        <meta name="author" content="pbprasad99">
      
      
        <link rel="canonical" href="https://pbprasad99.github.io/algorithmic_pareto/resources/asyncio_deep_dive/">
      
      
        <link rel="prev" href="../../blog/archive/2025/">
      
      
        <link rel="next" href="../Dimensional_Modeling_Cheatseet/">
      
      
      <link rel="icon" href="../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Asyncio Deep Dive: Mastering Asynchronous Python - patibanb.me</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Asyncio Deep Dive: Mastering Asynchronous Python - patibanb.me" >
      
        <meta  property="og:description"  content="Personal Website" >
      
        <meta  property="og:image"  content="https://pbprasad99.github.io/algorithmic_pareto/assets/images/social/resources/asyncio_deep_dive.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://pbprasad99.github.io/algorithmic_pareto/resources/asyncio_deep_dive/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Asyncio Deep Dive: Mastering Asynchronous Python - patibanb.me" >
      
        <meta  name="twitter:description"  content="Personal Website" >
      
        <meta  name="twitter:image"  content="https://pbprasad99.github.io/algorithmic_pareto/assets/images/social/resources/asyncio_deep_dive.png" >
      
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#asyncio-deep-dive-mastering-asynchronous-python" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="patibanb.me" class="md-header__button md-logo" aria-label="patibanb.me" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            patibanb.me
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Asyncio Deep Dive: Mastering Asynchronous Python
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Algorithms/Array_Partitioning/Introduction/" class="md-tabs__link">
          
  
  
    
  
  Algorithms - The Pareto Set

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../blog/" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
    
  
  Resources

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../About/" class="md-tabs__link">
          
  
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="patibanb.me" class="md-nav__button md-logo" aria-label="patibanb.me" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    patibanb.me
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Algorithms/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Algorithms - The Pareto Set
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Algorithms - The Pareto Set
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Array Partitioning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Array Partitioning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Array_Partitioning/Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Array_Partitioning/Hoare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hoare Partition
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Array_Partitioning/Lomuto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lomuto Partition
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Array_Partitioning/In-Place_Deduplication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    In-Place Deduplication
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Algorithms/Quickselect/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Quickselect
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Quickselect
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Algorithms/Quicksort/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Quicksort
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Quicksort
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Algorithms/Two_Way_Merge/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Two Way Merge
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Two Way Merge
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Algorithms/Merge_Sort/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Merge Sort
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Merge Sort
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Algorithms/K_Way_Merge/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    K Way Merge
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            K Way Merge
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/properties_of_comparison_based_sorting_algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Comparison Based Sorting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/External_Sorting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    External Sorting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Array Linearization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            Array Linearization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Array_Linearization/Mapping_2d_to_1d_Arrays/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mapping 2D Array to 1D Array
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Array_Linearization/Mapping_1d_to_2d_Arrays/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mapping 1D Array to 2D Array
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
        
          
          <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Misc Array Problems
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            Misc Array Problems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Misc_Array_Problems/Copying_and_allocating/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Allocate, Copy and Transpose 2D Matrix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Misc_Array_Problems/Diagonal_and_Antidiagonal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Diagonal and Antidiagonal traversal of Square Matrix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Misc_Array_Problems/In_Place_Transpose_of_a_Square_Matrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    In Place Transpose of a Square Matrix
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Binary search
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            Binary search
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Binary_search/Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Binary_search/Median_of_two_sorted_arrays/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Median of two sorted arrays
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Algorithms/Basic_Recursion/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Basic Recursion
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            Basic Recursion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Algorithms/Backtracking/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Backtracking
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_13">
            <span class="md-nav__icon md-icon"></span>
            Backtracking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_14" >
        
          
          <label class="md-nav__link" for="__nav_2_14" id="__nav_2_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Math
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_14">
            <span class="md-nav__icon md-icon"></span>
            Math
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Math/Division_Algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Division Algorithm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_14_2" >
        
          
          <label class="md-nav__link" for="__nav_2_14_2" id="__nav_2_14_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Fundamental Theorem Of Arithmetic
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_14_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_14_2">
            <span class="md-nav__icon md-icon"></span>
            Fundamental Theorem Of Arithmetic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Math/Fundamental_Theorem_Of_Arithmetic/Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Math/Fundamental_Theorem_Of_Arithmetic/claude_ugly_number_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Ugly Number Problem
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_14_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Algorithms/Math/Arithmetic_Series_and_Gauss_Summation/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Arithmetic Series and Gauss Summation
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_14_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_14_3">
            <span class="md-nav__icon md-icon"></span>
            Arithmetic Series and Gauss Summation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_14_4" >
        
          
          <label class="md-nav__link" for="__nav_2_14_4" id="__nav_2_14_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Appendix
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_14_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_14_4">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Math/Appendix/Number_Theoretic_Notation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Number Theoretic Notation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Algorithms/Math/Appendix/Set_Theoretic_Notation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Set Theoretic Notation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../blog/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Categories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/aws/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/c/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/etl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ETL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/encodings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Encodings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/iam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IAM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../blog/category/serverless/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Serverless
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Asyncio Deep Dive: Mastering Asynchronous Python
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Asyncio Deep Dive: Mastering Asynchronous Python
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-fundamental-problem-why-asyncio-exists" class="md-nav__link">
    <span class="md-ellipsis">
      The Fundamental Problem: Why Asyncio Exists
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-event-loop-the-heart-of-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      The Event Loop: The Heart of Asyncio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coroutines-the-building-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Coroutines: The Building Blocks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coroutines: The Building Blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-and-understanding-coroutines" class="md-nav__link">
    <span class="md-ellipsis">
      Creating and Understanding Coroutines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coroutine-states-and-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Coroutine States and Execution Flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-await-the-suspension-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding await: The Suspension Mechanism
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding await: The Suspension Mechanism">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-await-actually-does" class="md-nav__link">
    <span class="md-ellipsis">
      What await Actually Does
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#await-rules-and-awaitables" class="md-nav__link">
    <span class="md-ellipsis">
      await Rules and Awaitables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tasks-concurrent-execution-units" class="md-nav__link">
    <span class="md-ellipsis">
      Tasks: Concurrent Execution Units
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tasks: Concurrent Execution Units">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-tasks-vs-coroutines" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Tasks vs Coroutines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-management-and-control" class="md-nav__link">
    <span class="md-ellipsis">
      Task Management and Control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concurrent-execution-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Concurrent Execution Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Concurrent Execution Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asynciogather-all-or-nothing-coordination" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.gather(): All or Nothing Coordination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asyncioas_completed-process-results-as-they-arrive" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.as_completed(): Process Results as They Arrive
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asynciowait-fine-grained-control" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.wait(): Fine-Grained Control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronization-coordinating-concurrent-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronization: Coordinating Concurrent Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synchronization: Coordinating Concurrent Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asynciolock-mutual-exclusion" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.Lock: Mutual Exclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asynciosemaphore-limiting-concurrent-access" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.Semaphore: Limiting Concurrent Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asyncioevent-signaling-and-coordination" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.Event: Signaling and Coordination
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-and-resilience" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling and Resilience
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling and Resilience">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exception-propagation-in-concurrent-code" class="md-nav__link">
    <span class="md-ellipsis">
      Exception Propagation in Concurrent Code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-optimization-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimization and Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Optimization and Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-pooling-and-resource-management" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Pooling and Resource Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls-and-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls and Solutions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Pitfalls and Solutions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blocking-the-event-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Blocking the Event Loop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-application-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Real-World Application Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-World Application Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web-scraping-with-rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      Web Scraping with Rate Limiting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Dimensional_Modeling_Cheatseet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dimensional Data Modeling Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pyinstaller_deep_dive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PyInstaller Deep Dive: Complete Guide with uv
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-dictionary-cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python Dictionary Methods Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-lists-cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python Lists Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-regex-cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python Regular Expressions Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-sets-cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python Sets Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-strings-cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python Strings Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python_cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SQL_Basics_Cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SQL Basics Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Terraform_Data_Engineer_Cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terraform Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Terraform_Scenarios/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terraform Scenarios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../uv_cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uv Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../About/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-fundamental-problem-why-asyncio-exists" class="md-nav__link">
    <span class="md-ellipsis">
      The Fundamental Problem: Why Asyncio Exists
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-event-loop-the-heart-of-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      The Event Loop: The Heart of Asyncio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coroutines-the-building-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Coroutines: The Building Blocks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coroutines: The Building Blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-and-understanding-coroutines" class="md-nav__link">
    <span class="md-ellipsis">
      Creating and Understanding Coroutines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coroutine-states-and-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Coroutine States and Execution Flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-await-the-suspension-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding await: The Suspension Mechanism
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding await: The Suspension Mechanism">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-await-actually-does" class="md-nav__link">
    <span class="md-ellipsis">
      What await Actually Does
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#await-rules-and-awaitables" class="md-nav__link">
    <span class="md-ellipsis">
      await Rules and Awaitables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tasks-concurrent-execution-units" class="md-nav__link">
    <span class="md-ellipsis">
      Tasks: Concurrent Execution Units
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tasks: Concurrent Execution Units">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-tasks-vs-coroutines" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Tasks vs Coroutines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-management-and-control" class="md-nav__link">
    <span class="md-ellipsis">
      Task Management and Control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concurrent-execution-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Concurrent Execution Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Concurrent Execution Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asynciogather-all-or-nothing-coordination" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.gather(): All or Nothing Coordination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asyncioas_completed-process-results-as-they-arrive" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.as_completed(): Process Results as They Arrive
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asynciowait-fine-grained-control" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.wait(): Fine-Grained Control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronization-coordinating-concurrent-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronization: Coordinating Concurrent Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synchronization: Coordinating Concurrent Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asynciolock-mutual-exclusion" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.Lock: Mutual Exclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asynciosemaphore-limiting-concurrent-access" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.Semaphore: Limiting Concurrent Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asyncioevent-signaling-and-coordination" class="md-nav__link">
    <span class="md-ellipsis">
      asyncio.Event: Signaling and Coordination
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-and-resilience" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling and Resilience
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling and Resilience">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exception-propagation-in-concurrent-code" class="md-nav__link">
    <span class="md-ellipsis">
      Exception Propagation in Concurrent Code
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-optimization-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimization and Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Optimization and Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-pooling-and-resource-management" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Pooling and Resource Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls-and-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls and Solutions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Pitfalls and Solutions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blocking-the-event-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Blocking the Event Loop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-application-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Real-World Application Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-World Application Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web-scraping-with-rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      Web Scraping with Rate Limiting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="asyncio-deep-dive-mastering-asynchronous-python">Asyncio Deep Dive: Mastering Asynchronous Python<a class="headerlink" href="#asyncio-deep-dive-mastering-asynchronous-python" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">AI Assisted (Claude Sonnet 4)</p>
</div>
<h2 id="the-fundamental-problem-why-asyncio-exists">The Fundamental Problem: Why Asyncio Exists<a class="headerlink" href="#the-fundamental-problem-why-asyncio-exists" title="Permanent link">&para;</a></h2>
<p>Traditional Python code executes <strong>synchronously</strong> - one operation at a time, waiting for each to complete before starting the next. This creates a critical inefficiency problem:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sequential_downloads</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Traditional synchronous approach&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🐌 Starting sequential downloads...&quot;</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Each request blocks until complete</span>
    <span class="n">response1</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/delay/2&quot;</span><span class="p">)</span>  <span class="c1"># Wait 2 seconds</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ First download complete&quot;</span><span class="p">)</span>

    <span class="n">response2</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/delay/2&quot;</span><span class="p">)</span>  <span class="c1"># Wait another 2 seconds  </span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Second download complete&quot;</span><span class="p">)</span>

    <span class="n">response3</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/delay/2&quot;</span><span class="p">)</span>  <span class="c1"># Wait another 2 seconds</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Third download complete&quot;</span><span class="p">)</span>

    <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  Total time: </span><span class="si">{</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>  <span class="c1"># ~6 seconds</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">response1</span><span class="p">,</span> <span class="n">response2</span><span class="p">,</span> <span class="n">response3</span><span class="p">]</span>

<span class="c1"># sequential_downloads()  # Uncomment to see the slow approach</span>
</code></pre></div>
<p><strong>The inefficiency:</strong> While waiting for the first request, your CPU sits idle even though it could be starting the second and third requests simultaneously.</p>
<p><strong>Asyncio's solution:</strong> Enable <strong>cooperative multitasking</strong> where your program can juggle multiple operations, switching between them while waiting for I/O:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">concurrent_downloads</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Asyncio&#39;s concurrent approach&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🚀 Starting concurrent downloads...&quot;</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="c1"># Start all three requests simultaneously</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/delay/2&quot;</span><span class="p">),</span>
            <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/delay/2&quot;</span><span class="p">),</span> 
            <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/delay/2&quot;</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># Wait for all to complete</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

        <span class="c1"># Process responses</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">response</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">responses</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Download </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> complete&quot;</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  Total time: </span><span class="si">{</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>  <span class="c1"># ~2 seconds!</span>

    <span class="k">return</span> <span class="n">responses</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">concurrent_downloads</span><span class="p">())</span>
</code></pre></div>
<p><strong>Key insight:</strong> Asyncio doesn't make individual operations faster - it eliminates wasted waiting time by running operations concurrently.</p>
<h2 id="the-event-loop-the-heart-of-asyncio">The Event Loop: The Heart of Asyncio<a class="headerlink" href="#the-event-loop-the-heart-of-asyncio" title="Permanent link">&para;</a></h2>
<p>The <strong>event loop</strong> is asyncio's central coordinator - a single-threaded mechanism that manages and executes asynchronous tasks. Think of it as a highly efficient restaurant manager:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">restaurant_simulation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrates how the event loop coordinates multiple operations&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">serve_customer</span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span> <span class="n">service_time</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🍽️  Customer </span><span class="si">{</span><span class="n">customer_id</span><span class="si">}</span><span class="s2">: Order taken&quot;</span><span class="p">)</span>

        <span class="c1"># This represents I/O waiting (kitchen preparing food)</span>
        <span class="c1"># The event loop can serve other customers during this time</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">service_time</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Customer </span><span class="si">{</span><span class="n">customer_id</span><span class="si">}</span><span class="s2">: Order ready! (</span><span class="si">{</span><span class="n">service_time</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Meal for customer </span><span class="si">{</span><span class="n">customer_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🏪 Restaurant opens - Multiple customers arrive&quot;</span><span class="p">)</span>

    <span class="c1"># Customers with different service times</span>
    <span class="n">customers</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">serve_customer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span>  <span class="c1"># Slow order</span>
        <span class="n">serve_customer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>  <span class="c1"># Fast order</span>
        <span class="n">serve_customer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># Medium order</span>
        <span class="n">serve_customer</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># Medium-fast order</span>
    <span class="p">]</span>

    <span class="c1"># Event loop serves all customers concurrently</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">meals</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">customers</span><span class="p">)</span>
    <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🏪 All customers served in </span><span class="si">{</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Notice: Faster orders completed first, regardless of arrival order!&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">meals</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">restaurant_simulation</span><span class="p">())</span>
</code></pre></div>
<p><strong>Event Loop Mechanics:</strong></p>
<p>The event loop operates on a simple but powerful principle:</p>
<ol>
<li><strong>Run ready tasks</strong> until they hit an <code>await</code> (suspension point)</li>
<li><strong>Track waiting tasks</strong> and when they'll be ready to resume</li>
<li><strong>Resume tasks</strong> as their wait conditions are met</li>
<li><strong>Repeat</strong> until all tasks complete</li>
</ol>
<p>Here's a simplified view of what happens internally:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Conceptual view - don&#39;t run this code</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ConceptualEventLoop</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready_tasks</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c1"># Tasks ready to run now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waiting_tasks</span> <span class="o">=</span> <span class="p">[]</span>     <span class="c1"># Tasks waiting for I/O or timers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_callbacks</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># Scheduled callbacks</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_task</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main event loop execution&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_task</span><span class="p">)</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready_tasks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">waiting_tasks</span><span class="p">:</span>
            <span class="c1"># Execute all ready tasks</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready_tasks</span><span class="p">:</span>
                <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready_tasks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Run task until it hits &#39;await&#39;</span>
                    <span class="n">task</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">TaskComplete</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># Task finished</span>
                <span class="k">except</span> <span class="n">TaskSuspended</span> <span class="k">as</span> <span class="n">suspend_info</span><span class="p">:</span>
                    <span class="c1"># Task is waiting for something</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">waiting_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">task</span><span class="p">,</span> <span class="n">suspend_info</span><span class="p">))</span>

            <span class="c1"># Check which waiting tasks are now ready</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_waiting_tasks</span><span class="p">()</span>

            <span class="c1"># Handle timer callbacks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_timer_callbacks</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_waiting_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Move completed waits back to ready queue&quot;&quot;&quot;</span>
        <span class="n">still_waiting</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">task</span><span class="p">,</span> <span class="n">wait_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">waiting_tasks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">wait_info</span><span class="o">.</span><span class="n">is_ready</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ready_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">still_waiting</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">task</span><span class="p">,</span> <span class="n">wait_info</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waiting_tasks</span> <span class="o">=</span> <span class="n">still_waiting</span>
</code></pre></div>
<h2 id="coroutines-the-building-blocks">Coroutines: The Building Blocks<a class="headerlink" href="#coroutines-the-building-blocks" title="Permanent link">&para;</a></h2>
<p><strong>Coroutines</strong> are special functions that can be suspended and resumed. They're the fundamental units of work in asyncio.</p>
<h3 id="creating-and-understanding-coroutines">Creating and Understanding Coroutines<a class="headerlink" href="#creating-and-understanding-coroutines" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="c1"># Regular function - runs to completion immediately</span>
<span class="k">def</span><span class="w"> </span><span class="nf">regular_function</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Regular function </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> starting&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Result from </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Coroutine function - can be suspended and resumed</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">coroutine_function</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coroutine </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> starting&quot;</span><span class="p">)</span>

    <span class="c1"># This is a suspension point - execution can pause here</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coroutine </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> resuming after 1 second&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Async result from </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_coroutine_lifecycle</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Regular Function ===&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">regular_function</span><span class="p">(</span><span class="s2">&quot;RegularFunc&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Coroutine Function ===&quot;</span><span class="p">)</span>

    <span class="c1"># Calling a coroutine function doesn&#39;t run it!</span>
    <span class="n">coro</span> <span class="o">=</span> <span class="n">coroutine_function</span><span class="p">(</span><span class="s2">&quot;CoroFunc&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coroutine object created: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">coro</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># You must await it to actually run it</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Multiple Coroutines Concurrently ===&quot;</span><span class="p">)</span>
    <span class="c1"># Multiple coroutines can run together</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
        <span class="n">coroutine_function</span><span class="p">(</span><span class="s2">&quot;Coro1&quot;</span><span class="p">),</span>
        <span class="n">coroutine_function</span><span class="p">(</span><span class="s2">&quot;Coro2&quot;</span><span class="p">),</span> 
        <span class="n">coroutine_function</span><span class="p">(</span><span class="s2">&quot;Coro3&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All results: </span><span class="si">{</span><span class="n">results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">demonstrate_coroutine_lifecycle</span><span class="p">())</span>
</code></pre></div>
<h3 id="coroutine-states-and-execution-flow">Coroutine States and Execution Flow<a class="headerlink" href="#coroutine-states-and-execution-flow" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">trace_coroutine_execution</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrates the different states a coroutine goes through&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">traced_operation</span><span class="p">(</span><span class="n">operation_id</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🚀 Operation </span><span class="si">{</span><span class="n">operation_id</span><span class="si">}</span><span class="s2">: Starting&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏸️  Operation </span><span class="si">{</span><span class="n">operation_id</span><span class="si">}</span><span class="s2">: About to suspend (await)&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Suspension point</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;▶️  Operation </span><span class="si">{</span><span class="n">operation_id</span><span class="si">}</span><span class="s2">: Resumed after await&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏸️  Operation </span><span class="si">{</span><span class="n">operation_id</span><span class="si">}</span><span class="s2">: Another suspension point&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Operation </span><span class="si">{</span><span class="n">operation_id</span><span class="si">}</span><span class="s2">: Completed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Result-</span><span class="si">{</span><span class="n">operation_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating coroutines (not running yet)...&quot;</span><span class="p">)</span>
    <span class="n">coro1</span> <span class="o">=</span> <span class="n">traced_operation</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
    <span class="n">coro2</span> <span class="o">=</span> <span class="n">traced_operation</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coroutine states: </span><span class="si">{</span><span class="n">inspect</span><span class="o">.</span><span class="n">getcoroutinestate</span><span class="p">(</span><span class="n">coro1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Starting concurrent execution...&quot;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">coro1</span><span class="p">,</span> <span class="n">coro2</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Final results: </span><span class="si">{</span><span class="n">results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">trace_coroutine_execution</span><span class="p">())</span>
</code></pre></div>
<h2 id="understanding-await-the-suspension-mechanism">Understanding await: The Suspension Mechanism<a class="headerlink" href="#understanding-await-the-suspension-mechanism" title="Permanent link">&para;</a></h2>
<p>The <code>await</code> keyword is where the magic happens. It's not just syntax - it's the mechanism that allows cooperative multitasking.</p>
<h3 id="what-await-actually-does">What await Actually Does<a class="headerlink" href="#what-await-actually-does" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_await_behavior</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows exactly what happens at await points&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🎬 Starting demonstration&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📍 Point 1: Before first await&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># This suspends the coroutine and yields control to the event loop</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📍 Point 2: After first await (</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s elapsed)&quot;</span><span class="p">)</span>

    <span class="c1"># Another suspension point</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📍 Point 3: After second await (</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s elapsed)&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;Demo complete&quot;</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_concurrent_awaits</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows how multiple awaits can run concurrently&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">worker</span><span class="p">(</span><span class="n">worker_id</span><span class="p">,</span> <span class="n">work_duration</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;👷 Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">: Starting work (</span><span class="si">{</span><span class="n">work_duration</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">work_duration</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">: Work complete&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Work result from </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🏭 Starting workers concurrently...&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># All workers start at the same time</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
        <span class="n">worker</span><span class="p">(</span><span class="s2">&quot;Alpha&quot;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
        <span class="n">worker</span><span class="p">(</span><span class="s2">&quot;Beta&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="n">worker</span><span class="p">(</span><span class="s2">&quot;Gamma&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🏁 All work completed in </span><span class="si">{</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📊 Results: </span><span class="si">{</span><span class="n">results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">demonstrate_await_behavior</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">demonstrate_concurrent_awaits</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<h3 id="await-rules-and-awaitables">await Rules and Awaitables<a class="headerlink" href="#await-rules-and-awaitables" title="Permanent link">&para;</a></h3>
<p>Not everything can be awaited. Only <strong>awaitable</strong> objects work with <code>await</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomAwaitable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example of creating a custom awaitable object&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__await__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This makes the object awaitable&quot;&quot;&quot;</span>
        <span class="c1"># Yield control to event loop for the specified delay</span>
        <span class="k">yield from</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">)</span><span class="o">.</span><span class="fm">__await__</span><span class="p">()</span>
        <span class="c1"># Return the final value</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Custom result: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_awaitables</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Built-in Awaitables ===&quot;</span><span class="p">)</span>

    <span class="c1"># Coroutines are awaitable</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">simple_coro</span><span class="p">():</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Coroutine result&quot;</span>

    <span class="n">result1</span> <span class="o">=</span> <span class="k">await</span> <span class="n">simple_coro</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coroutine result: </span><span class="si">{</span><span class="n">result1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Tasks are awaitable</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">simple_coro</span><span class="p">())</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">task</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task result: </span><span class="si">{</span><span class="n">result2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Futures are awaitable</span>
    <span class="n">future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">()</span>
    <span class="n">future</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="s2">&quot;Future result&quot;</span><span class="p">)</span>
    <span class="n">result3</span> <span class="o">=</span> <span class="k">await</span> <span class="n">future</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Future result: </span><span class="si">{</span><span class="n">result3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Custom Awaitable ===&quot;</span><span class="p">)</span>
    <span class="n">custom</span> <span class="o">=</span> <span class="n">CustomAwaitable</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">result4</span> <span class="o">=</span> <span class="k">await</span> <span class="n">custom</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Custom awaitable result: </span><span class="si">{</span><span class="n">result4</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== What&#39;s NOT Awaitable ===&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># This will fail - regular functions aren&#39;t awaitable</span>
        <span class="c1"># await time.sleep(1)  # ❌ TypeError</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">demonstrate_awaitables</span><span class="p">())</span>
</code></pre></div>
<h2 id="tasks-concurrent-execution-units">Tasks: Concurrent Execution Units<a class="headerlink" href="#tasks-concurrent-execution-units" title="Permanent link">&para;</a></h2>
<p><strong>Tasks</strong> are the primary mechanism for running coroutines concurrently. They wrap coroutines and manage their execution within the event loop.</p>
<h3 id="understanding-tasks-vs-coroutines">Understanding Tasks vs Coroutines<a class="headerlink" href="#understanding-tasks-vs-coroutines" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_tasks_vs_coroutines</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows the critical difference between creating coroutines and tasks&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">background_work</span><span class="p">(</span><span class="n">work_id</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔧 Work </span><span class="si">{</span><span class="n">work_id</span><span class="si">}</span><span class="s2">: Starting (</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">)):</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚙️  Work </span><span class="si">{</span><span class="n">work_id</span><span class="si">}</span><span class="s2">: Progress </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Work </span><span class="si">{</span><span class="n">work_id</span><span class="si">}</span><span class="s2">: Complete&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Result-</span><span class="si">{</span><span class="n">work_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Coroutines: Don&#39;t Start Until Awaited ===&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Creating coroutines doesn&#39;t start them</span>
    <span class="n">coro1</span> <span class="o">=</span> <span class="n">background_work</span><span class="p">(</span><span class="s2">&quot;Coro-A&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">coro2</span> <span class="o">=</span> <span class="n">background_work</span><span class="p">(</span><span class="s2">&quot;Coro-B&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  Coroutines created at </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Wait 1 second</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  1 second later - no work has started yet&quot;</span><span class="p">)</span>

    <span class="c1"># Now run them sequentially</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro1</span>  <span class="c1"># Runs for 2 seconds</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro2</span>  <span class="c1"># Runs for another 2 seconds</span>

    <span class="n">coro_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  Coroutines completed in </span><span class="si">{</span><span class="n">coro_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s (sequential)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Tasks: Start Immediately ===&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Creating tasks starts them immediately!</span>
    <span class="n">task1</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">background_work</span><span class="p">(</span><span class="s2">&quot;Task-A&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">task2</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">background_work</span><span class="p">(</span><span class="s2">&quot;Task-B&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  Tasks created at </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Wait 1 second</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  1 second later - work is already running!&quot;</span><span class="p">)</span>

    <span class="c1"># Wait for both to complete (they run concurrently)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">task2</span><span class="p">)</span>

    <span class="n">task_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  Tasks completed in </span><span class="si">{</span><span class="n">task_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s (concurrent)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 Time difference: </span><span class="si">{</span><span class="n">coro_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">task_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s saved with tasks!&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">demonstrate_tasks_vs_coroutines</span><span class="p">())</span>
</code></pre></div>
<h3 id="task-management-and-control">Task Management and Control<a class="headerlink" href="#task-management-and-control" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_task_management</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows how to manage, monitor, and control tasks&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">worker_task</span><span class="p">(</span><span class="n">worker_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A worker that does some work and might fail&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">work_time</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;👷 Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">: Starting </span><span class="si">{</span><span class="n">work_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s of work&quot;</span><span class="p">)</span>

            <span class="c1"># Simulate work with progress updates</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">work_time</span><span class="p">)):</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚙️  Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">work_time</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds complete&quot;</span><span class="p">)</span>

            <span class="c1"># Simulate random failures</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>  <span class="c1"># 30% chance of failure</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2"> encountered an error!&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">: Work completed successfully&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Success-</span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🛑 Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">: Cancelled during work&quot;</span><span class="p">)</span>
            <span class="k">raise</span>  <span class="c1"># Re-raise to complete cancellation</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🏭 Starting worker management demo&quot;</span><span class="p">)</span>

    <span class="c1"># Create multiple tasks</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">worker_task</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;W</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># Monitor task progress</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">monitor_tasks</span><span class="p">():</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="n">pending</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tasks</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="o">.</span><span class="n">done</span><span class="p">()]</span>
            <span class="n">completed</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tasks</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">t</span><span class="o">.</span><span class="n">cancelled</span><span class="p">()]</span>
            <span class="n">cancelled</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tasks</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">cancelled</span><span class="p">()]</span>
            <span class="n">failed</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tasks</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">exception</span><span class="p">()]</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📊 Status: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span><span class="si">}</span><span class="s2"> pending, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">completed</span><span class="p">)</span><span class="si">}</span><span class="s2"> completed, &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cancelled</span><span class="p">)</span><span class="si">}</span><span class="s2"> cancelled, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span><span class="si">}</span><span class="s2"> failed&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">pending</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="n">monitor_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">monitor_tasks</span><span class="p">())</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Let tasks run for a bit</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Cancel any remaining tasks that are taking too long</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">task</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏰ Cancelling slow task...&quot;</span><span class="p">)</span>
                <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="c1"># Wait for all tasks to finish (including cancellation)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📋 Final Results:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: Cancelled&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: Failed - </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="n">monitor_task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">monitor_task</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">demonstrate_task_management</span><span class="p">())</span>
</code></pre></div>
<h2 id="concurrent-execution-patterns">Concurrent Execution Patterns<a class="headerlink" href="#concurrent-execution-patterns" title="Permanent link">&para;</a></h2>
<p>Asyncio provides several patterns for running multiple operations. Each has different use cases and behaviors.</p>
<h3 id="asynciogather-all-or-nothing-coordination">asyncio.gather(): All or Nothing Coordination<a class="headerlink" href="#asynciogather-all-or-nothing-coordination" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_url</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch a URL and return info about the request&quot;&quot;&quot;</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🌐 </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: Starting request to </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: Completed in </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
            <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: Failed after </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s - </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_gather</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows gather() behavior with success and failure scenarios&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== gather() with all successful requests ===&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="n">fetch_url</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;https://httpbin.org/delay/1&quot;</span><span class="p">,</span> <span class="s2">&quot;Fast&quot;</span><span class="p">),</span>
                <span class="n">fetch_url</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;https://httpbin.org/delay/2&quot;</span><span class="p">,</span> <span class="s2">&quot;Medium&quot;</span><span class="p">),</span>
                <span class="n">fetch_url</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;https://httpbin.org/delay/1.5&quot;</span><span class="p">,</span> <span class="s2">&quot;Quick&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📊 All requests successful:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ gather() failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== gather() with one failure (default behavior) ===&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="n">fetch_url</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;https://httpbin.org/delay/1&quot;</span><span class="p">,</span> <span class="s2">&quot;Success1&quot;</span><span class="p">),</span>
                <span class="n">fetch_url</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;https://httpbin.org/status/500&quot;</span><span class="p">,</span> <span class="s2">&quot;Failure&quot;</span><span class="p">),</span>  <span class="c1"># Will fail</span>
                <span class="n">fetch_url</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;https://httpbin.org/delay/1&quot;</span><span class="p">,</span> <span class="s2">&quot;Success2&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ gather() failed fast due to: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== gather() with return_exceptions=True ===&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">fetch_url</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;https://httpbin.org/delay/1&quot;</span><span class="p">,</span> <span class="s2">&quot;Success1&quot;</span><span class="p">),</span>
            <span class="n">fetch_url</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;https://httpbin.org/status/500&quot;</span><span class="p">,</span> <span class="s2">&quot;Failure&quot;</span><span class="p">),</span>
            <span class="n">fetch_url</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;https://httpbin.org/delay/1&quot;</span><span class="p">,</span> <span class="s2">&quot;Success2&quot;</span><span class="p">),</span>
            <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Don&#39;t fail, return exceptions</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📊 Mixed results (exceptions returned):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Request </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: Failed - </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Request </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: Success - </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">demonstrate_gather</span><span class="p">())</span>
</code></pre></div>
<h3 id="asyncioas_completed-process-results-as-they-arrive">asyncio.as_completed(): Process Results as They Arrive<a class="headerlink" href="#asyncioas_completed-process-results-as-they-arrive" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">variable_duration_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Task with random duration to demonstrate as_completed behavior&quot;&quot;&quot;</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🚀 Task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">: Starting (</span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s estimated)&quot;</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">: Completed after </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;task_id&quot;</span><span class="p">:</span> <span class="n">task_id</span><span class="p">,</span>
        <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
        <span class="s2">&quot;completed_at&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="p">}</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_as_completed</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows how as_completed processes results in completion order&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🎯 Creating tasks with random durations&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Create tasks with different expected completion times</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">variable_duration_task</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⏳ Processing results as they complete (not in creation order):&quot;</span><span class="p">)</span>

    <span class="n">completion_order</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Process results as they become available</span>
    <span class="k">for</span> <span class="n">completed_task</span> <span class="ow">in</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">tasks</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">completed_task</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="n">completion_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;task_id&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📥 Received result from </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;task_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;after </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s total elapsed&quot;</span><span class="p">)</span>

    <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 All tasks completed in </span><span class="si">{</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔄 Completion order: </span><span class="si">{</span><span class="s1">&#39; → &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">completion_order</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;💡 Notice: Results arrived in completion order, not creation order!&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_as_completed_with_timeout</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows as_completed with timeout handling&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">slow_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2"> result&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⏰ as_completed with timeout demonstration&quot;</span><span class="p">)</span>

    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">slow_task</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">slow_task</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>  <span class="c1"># Will timeout</span>
        <span class="n">slow_task</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">slow_task</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>  <span class="c1"># Will timeout</span>
    <span class="p">]</span>

    <span class="n">completed_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">timeout_seconds</span> <span class="o">=</span> <span class="mf">2.5</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">completed_task</span> <span class="ow">in</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout_seconds</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">completed_task</span>
                <span class="n">completed_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Completed </span><span class="si">{</span><span class="n">completed_count</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏰ Task timed out after </span><span class="si">{</span><span class="n">timeout_seconds</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏰ Overall timeout reached after </span><span class="si">{</span><span class="n">timeout_seconds</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📊 Completed </span><span class="si">{</span><span class="n">completed_count</span><span class="si">}</span><span class="s2"> tasks before timeout&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">demonstrate_as_completed</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_as_completed_with_timeout</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<h3 id="asynciowait-fine-grained-control">asyncio.wait(): Fine-Grained Control<a class="headerlink" href="#asynciowait-fine-grained-control" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">controlled_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">should_fail</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Task for demonstrating wait() control features&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🚀 Task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">: Starting&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">should_fail</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2"> intentionally failed&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">: Completed successfully&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Result from task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🛑 Task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">: Cancelled&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_wait_conditions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows different wait conditions and their behaviors&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== FIRST_COMPLETED: Return when any task finishes ===&quot;</span><span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">controlled_task</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">controlled_task</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">controlled_task</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
    <span class="p">]</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
        <span class="n">tasks</span><span class="p">,</span> 
        <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span>
    <span class="p">)</span>
    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  First completion after </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📊 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">done</span><span class="p">)</span><span class="si">}</span><span class="s2"> completed, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span><span class="si">}</span><span class="s2"> still running&quot;</span><span class="p">)</span>

    <span class="c1"># Get result from completed task</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">task</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🎯 First result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Cancel remaining tasks</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">pending</span><span class="p">:</span>
        <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

    <span class="c1"># Wait for cancellation to complete</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== FIRST_EXCEPTION: Return when any task fails ===&quot;</span><span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">controlled_task</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">should_fail</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">controlled_task</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">should_fail</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>   <span class="c1"># Will fail</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">controlled_task</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">should_fail</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">]</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
        <span class="n">tasks</span><span class="p">,</span>
        <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">FIRST_EXCEPTION</span>
    <span class="p">)</span>
    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  First exception after </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

    <span class="c1"># Check for exceptions</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">task</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Task completed: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Task failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Cancel and wait for remaining tasks</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">pending</span><span class="p">:</span>
        <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_wait_with_timeout</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows wait() with timeout functionality&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== wait() with timeout ===&quot;</span><span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">controlled_task</span><span class="p">(</span><span class="s2">&quot;Fast&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">controlled_task</span><span class="p">(</span><span class="s2">&quot;Medium&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">controlled_task</span><span class="p">(</span><span class="s2">&quot;Slow&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
    <span class="p">]</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Wait up to 2 seconds</span>
    <span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
        <span class="n">tasks</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">ALL_COMPLETED</span>
    <span class="p">)</span>

    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  Timeout reached after </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📊 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">done</span><span class="p">)</span><span class="si">}</span><span class="s2"> completed, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span><span class="si">}</span><span class="s2"> timed out&quot;</span><span class="p">)</span>

    <span class="c1"># Process completed tasks</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">task</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Completed before timeout: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Handle timed-out tasks</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">pending</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏰ Task timed out, cancelling...&quot;</span><span class="p">)</span>
        <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

    <span class="c1"># Wait for cancellation</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">demonstrate_wait_conditions</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_wait_with_timeout</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<h2 id="synchronization-coordinating-concurrent-operations">Synchronization: Coordinating Concurrent Operations<a class="headerlink" href="#synchronization-coordinating-concurrent-operations" title="Permanent link">&para;</a></h2>
<p>When multiple coroutines work with shared resources, you need synchronization primitives to prevent race conditions and coordinate access.</p>
<h3 id="asynciolock-mutual-exclusion">asyncio.Lock: Mutual Exclusion<a class="headerlink" href="#asynciolock-mutual-exclusion" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SharedCounter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrates the need for locks in concurrent operations&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation_log</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">unsafe_increment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unsafe increment that can cause race conditions&quot;&quot;&quot;</span>
        <span class="c1"># Read current value</span>
        <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># Simulate some processing time (this is where race conditions occur)</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

        <span class="c1"># Write back the incremented value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">old_value</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">operation_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">old_value</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">safe_increment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Safe increment using a lock&quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>  <span class="c1"># Only one worker can execute this block at a time</span>
            <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

            <span class="c1"># Even with delay, no race condition occurs</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">old_value</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operation_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">old_value</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_race_conditions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows the difference between safe and unsafe concurrent operations&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Race Condition Demonstration ===&quot;</span><span class="p">)</span>

    <span class="c1"># Test unsafe operations</span>
    <span class="n">unsafe_counter</span> <span class="o">=</span> <span class="n">SharedCounter</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🚨 Running UNSAFE concurrent increments...&quot;</span><span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">unsafe_counter</span><span class="o">.</span><span class="n">unsafe_increment</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;U</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Expected final value: 10, Actual: </span><span class="si">{</span><span class="n">unsafe_counter</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📋 Last few operations:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">log_entry</span> <span class="ow">in</span> <span class="n">unsafe_counter</span><span class="o">.</span><span class="n">operation_log</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">log_entry</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Test safe operations</span>
    <span class="n">safe_counter</span> <span class="o">=</span> <span class="n">SharedCounter</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✅ Running SAFE concurrent increments...&quot;</span><span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">safe_counter</span><span class="o">.</span><span class="n">safe_increment</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;S</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Expected final value: 10, Actual: </span><span class="si">{</span><span class="n">safe_counter</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📋 Last few operations:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">log_entry</span> <span class="ow">in</span> <span class="n">safe_counter</span><span class="o">.</span><span class="n">operation_log</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">log_entry</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_lock_usage_patterns</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows different patterns for using locks effectively&quot;&quot;&quot;</span>

    <span class="n">lock</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
    <span class="n">shared_resource</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;processing_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">producer</span><span class="p">(</span><span class="n">producer_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Produces data items&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;P</span><span class="si">{</span><span class="n">producer_id</span><span class="si">}</span><span class="s2">-Item</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">async</span> <span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
                <span class="n">shared_resource</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📦 Producer </span><span class="si">{</span><span class="n">producer_id</span><span class="si">}</span><span class="s2"> added: </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Simulate work between productions</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">processor</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Processes data items&quot;&quot;&quot;</span>
        <span class="n">processed_items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">processed_items</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>  <span class="c1"># Expect 3 producers × 3 items each</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">shared_resource</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">shared_resource</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">shared_resource</span><span class="p">[</span><span class="s2">&quot;processing_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">current_count</span> <span class="o">=</span> <span class="n">shared_resource</span><span class="p">[</span><span class="s2">&quot;processing_count&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
                <span class="c1"># Process outside the lock to allow other operations</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># Simulate processing time</span>
                <span class="n">processed_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔧 Processed: </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2"> (#</span><span class="si">{</span><span class="n">current_count</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No items available, wait a bit</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">processed_items</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Producer-Consumer with Lock ===&quot;</span><span class="p">)</span>

    <span class="c1"># Start producers and processor concurrently</span>
    <span class="n">producer_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">producer</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
    <span class="n">processor_task</span> <span class="o">=</span> <span class="n">processor</span><span class="p">()</span>

    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">producer_tasks</span><span class="p">,</span> <span class="n">processor_task</span><span class="p">)</span>
    <span class="n">processed_items</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Last result is from processor</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📊 Processing complete: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_items</span><span class="p">)</span><span class="si">}</span><span class="s2"> items processed&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">demonstrate_race_conditions</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_lock_usage_patterns</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<h3 id="asynciosemaphore-limiting-concurrent-access">asyncio.Semaphore: Limiting Concurrent Access<a class="headerlink" href="#asynciosemaphore-limiting-concurrent-access" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RateLimitedDownloader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrates semaphore usage for controlling concurrent operations&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_concurrent_downloads</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semaphore</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">max_concurrent_downloads</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;started&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;concurrent_peak&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;currently_running&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_lock</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">file_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download a file with concurrency limiting&quot;&quot;&quot;</span>

        <span class="c1"># Wait for permission to start download</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">semaphore</span><span class="p">:</span>
            <span class="c1"># Update stats</span>
            <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_lock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s2">&quot;started&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s2">&quot;currently_running&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s2">&quot;currently_running&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s2">&quot;concurrent_peak&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s2">&quot;concurrent_peak&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s2">&quot;currently_running&quot;</span><span class="p">]</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🌐 Download </span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">: Starting (concurrent: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s1">&#39;currently_running&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Simulate download</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="n">download_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

                <span class="c1"># Simulate file processing</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

                <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_lock</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s2">&quot;currently_running&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Download </span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">: Complete (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes in </span><span class="si">{</span><span class="n">download_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;file_id&quot;</span><span class="p">:</span> <span class="n">file_id</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">download_time</span><span class="p">}</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_lock</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s2">&quot;currently_running&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Download </span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">: Failed - </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">raise</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_semaphore_benefits</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows how semaphores prevent overwhelming services&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Semaphore: Controlling Concurrent Downloads ===&quot;</span><span class="p">)</span>

    <span class="c1"># Create downloader with limit of 3 concurrent downloads</span>
    <span class="n">downloader</span> <span class="o">=</span> <span class="n">RateLimitedDownloader</span><span class="p">(</span><span class="n">max_concurrent_downloads</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Prepare many download URLs</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;https://httpbin.org/bytes/1024&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="c1"># Start all downloads (but semaphore limits concurrency)</span>
        <span class="n">download_tasks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">downloader</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;File-</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">download_tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="c1"># Analyze results</span>
    <span class="n">successful</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)]</span>
    <span class="n">failed</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 Download Statistics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total downloads: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Successful: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">successful</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Failed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total time: </span><span class="si">{</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Peak concurrent: </span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">download_stats</span><span class="p">[</span><span class="s1">&#39;concurrent_peak&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average time per download: </span><span class="si">{</span><span class="n">total_time</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">successful</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_semaphore_vs_unlimited</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compares semaphore-limited vs unlimited concurrent access&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">unlimited_downloads</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Downloads without any concurrency limiting&quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">simple_download</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">file_id</span><span class="p">):</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🚀 Unlimited </span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">duration</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">simple_download</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;https://httpbin.org/delay/1&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;U</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">limited_downloads</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Downloads with semaphore limiting to 3 concurrent&quot;&quot;&quot;</span>
        <span class="n">semaphore</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">limited_download</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">file_id</span><span class="p">):</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">semaphore</span><span class="p">:</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🎛️  Limited </span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">duration</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">limited_download</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;https://httpbin.org/delay/1&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;L</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚡ Unlimited Concurrent Downloads (may overwhelm server):&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">unlimited_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">unlimited_downloads</span><span class="p">()</span>
    <span class="n">unlimited_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🎛️  Limited Concurrent Downloads (3 at a time):&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">limited_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">limited_downloads</span><span class="p">()</span>
    <span class="n">limited_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📈 Comparison:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Unlimited: </span><span class="si">{</span><span class="n">unlimited_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s total, avg </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">unlimited_results</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">unlimited_results</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s per download&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Limited:   </span><span class="si">{</span><span class="n">limited_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s total, avg </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">limited_results</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">limited_results</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s per download&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">demonstrate_semaphore_benefits</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_semaphore_vs_unlimited</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<h3 id="asyncioevent-signaling-and-coordination">asyncio.Event: Signaling and Coordination<a class="headerlink" href="#asyncioevent-signaling-and-coordination" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_event_coordination</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows how events coordinate multiple coroutines&quot;&quot;&quot;</span>

    <span class="c1"># Events for coordination</span>
    <span class="n">start_event</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
    <span class="n">data_ready_event</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
    <span class="n">processing_complete_event</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>

    <span class="c1"># Shared data</span>
    <span class="n">shared_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;processed_items&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">data_producer</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Produces data and signals when ready&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📦 Producer: Waiting for start signal...&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">start_event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📦 Producer: Starting data generation...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Data-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">shared_data</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📦 Producer: Generated </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># Simulate generation time</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📦 Producer: All data generated, signaling data_ready&quot;</span><span class="p">)</span>
        <span class="n">data_ready_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">data_processor</span><span class="p">(</span><span class="n">processor_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Processes data after it&#39;s ready&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔧 Processor </span><span class="si">{</span><span class="n">processor_id</span><span class="si">}</span><span class="s2">: Waiting for data...&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">data_ready_event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔧 Processor </span><span class="si">{</span><span class="n">processor_id</span><span class="si">}</span><span class="s2">: Data is ready, starting processing...&quot;</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">shared_data</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">shared_data</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]:</span>  <span class="c1"># Double-check in case another processor took it</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">shared_data</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># Simulate processing</span>
                <span class="n">processing_time</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">processing_time</span><span class="p">)</span>

                <span class="n">processed_item</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Processed-</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">-by-P</span><span class="si">{</span><span class="n">processor_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">shared_data</span><span class="p">[</span><span class="s2">&quot;processed_items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_item</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔧 Processor </span><span class="si">{</span><span class="n">processor_id</span><span class="si">}</span><span class="s2">: Completed </span><span class="si">{</span><span class="n">processed_item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔧 Processor </span><span class="si">{</span><span class="n">processor_id</span><span class="si">}</span><span class="s2">: No more items to process&quot;</span><span class="p">)</span>

        <span class="c1"># Check if all processing is done</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">shared_data</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">shared_data</span><span class="p">[</span><span class="s2">&quot;processed_items&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔧 Processor </span><span class="si">{</span><span class="n">processor_id</span><span class="si">}</span><span class="s2">: All processing complete, signaling completion&quot;</span><span class="p">)</span>
            <span class="n">processing_complete_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">coordinator</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Coordinates the entire process&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;👨‍💼 Coordinator: Setting up workers...&quot;</span><span class="p">)</span>

        <span class="c1"># Start producer and processors</span>
        <span class="n">producer_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">data_producer</span><span class="p">())</span>
        <span class="n">processor_tasks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">data_processor</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># 3 processors</span>
        <span class="p">]</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Let everyone get ready</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;👨‍💼 Coordinator: Sending start signal!&quot;</span><span class="p">)</span>
        <span class="n">start_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="c1"># Wait for processing to complete</span>
        <span class="k">await</span> <span class="n">processing_complete_event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;👨‍💼 Coordinator: All work completed!&quot;</span><span class="p">)</span>

        <span class="c1"># Wait for all tasks to finish</span>
        <span class="k">await</span> <span class="n">producer_task</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">processor_tasks</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">shared_data</span><span class="p">[</span><span class="s2">&quot;processed_items&quot;</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Event-Coordinated Processing Pipeline ===&quot;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coordinator</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📊 Final results: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> items processed&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✅ </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_event_patterns</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows common event usage patterns&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">waiter</span><span class="p">(</span><span class="n">waiter_id</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Waits for an event with timeout&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏳ Waiter </span><span class="si">{</span><span class="n">waiter_id</span><span class="si">}</span><span class="s2">: Waiting for event...&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">wait</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🎉 Waiter </span><span class="si">{</span><span class="n">waiter_id</span><span class="si">}</span><span class="s2">: Event received!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏰ Waiter </span><span class="si">{</span><span class="n">waiter_id</span><span class="si">}</span><span class="s2">: Timeout waiting for event&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delayed_setter</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">event_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets an event after a delay&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏰ Setter: Will signal &#39;</span><span class="si">{</span><span class="n">event_name</span><span class="si">}</span><span class="s2">&#39; in </span><span class="si">{</span><span class="n">delay</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📢 Setter: Signaling &#39;</span><span class="si">{</span><span class="n">event_name</span><span class="si">}</span><span class="s2">&#39;!&quot;</span><span class="p">)</span>
        <span class="n">event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Event Timeout Patterns ===&quot;</span><span class="p">)</span>

    <span class="c1"># Test 1: Event set before timeout</span>
    <span class="n">quick_event</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
        <span class="n">waiter</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">quick_event</span><span class="p">),</span>
        <span class="n">delayed_setter</span><span class="p">(</span><span class="n">quick_event</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;quick_event&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Test 2: Event not set before timeout</span>
    <span class="n">slow_event</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
        <span class="n">waiter</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">slow_event</span><span class="p">),</span>
        <span class="n">delayed_setter</span><span class="p">(</span><span class="n">slow_event</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s2">&quot;slow_event&quot;</span><span class="p">)</span>  <span class="c1"># Will timeout</span>
    <span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">demonstrate_event_coordination</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_event_patterns</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<h2 id="error-handling-and-resilience">Error Handling and Resilience<a class="headerlink" href="#error-handling-and-resilience" title="Permanent link">&para;</a></h2>
<p>Proper error handling in asyncio requires understanding how exceptions propagate through concurrent operations.</p>
<h3 id="exception-propagation-in-concurrent-code">Exception Propagation in Concurrent Code<a class="headerlink" href="#exception-propagation-in-concurrent-code" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_exception_propagation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows how exceptions behave in different asyncio patterns&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">reliable_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Success from </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">unreliable_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">failure_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">failure_rate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2"> failed randomly!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Success from </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== gather() Exception Behavior ===&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🧪 Test 1: gather() with default behavior (fail fast)&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="n">reliable_task</span><span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">),</span>
            <span class="n">unreliable_task</span><span class="p">(</span><span class="s2">&quot;U1&quot;</span><span class="p">,</span> <span class="n">failure_rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>  <span class="c1"># Will definitely fail</span>
            <span class="n">reliable_task</span><span class="p">(</span><span class="s2">&quot;R2&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ All completed: </span><span class="si">{</span><span class="n">results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ gather() failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;💡 Note: When one task fails, gather() raises immediately&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🧪 Test 2: gather() with return_exceptions=True&quot;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
        <span class="n">reliable_task</span><span class="p">(</span><span class="s2">&quot;R3&quot;</span><span class="p">),</span>
        <span class="n">unreliable_task</span><span class="p">(</span><span class="s2">&quot;U2&quot;</span><span class="p">,</span> <span class="n">failure_rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>  <span class="c1"># Will definitely fail</span>
        <span class="n">reliable_task</span><span class="p">(</span><span class="s2">&quot;R4&quot;</span><span class="p">),</span>
        <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Return exceptions instead of raising</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📊 Mixed results:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: ❌ </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: ✅ </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_task_exception_handling</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows proper exception handling with individual tasks&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">monitored_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">should_fail</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">should_fail</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2"> encountered an error&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Result from </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🛑 Task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">: Cancelled&quot;</span><span class="p">)</span>
            <span class="k">raise</span>  <span class="c1"># Always re-raise CancelledError</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Individual Task Exception Handling ===&quot;</span><span class="p">)</span>

    <span class="c1"># Create tasks</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">monitored_task</span><span class="p">(</span><span class="s2">&quot;T1&quot;</span><span class="p">,</span> <span class="n">should_fail</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">monitored_task</span><span class="p">(</span><span class="s2">&quot;T2&quot;</span><span class="p">,</span> <span class="n">should_fail</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">monitored_task</span><span class="p">(</span><span class="s2">&quot;T3&quot;</span><span class="p">,</span> <span class="n">should_fail</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">monitored_task</span><span class="p">(</span><span class="s2">&quot;T4&quot;</span><span class="p">,</span> <span class="n">should_fail</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
    <span class="p">]</span>

    <span class="c1"># Handle each task individually</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tasks</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">task</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📊 Final results: </span><span class="si">{</span><span class="nb">len</span><span class="p">([</span><span class="n">r</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)])</span><span class="si">}</span><span class="s2"> successful&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_timeout_handling</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows comprehensive timeout handling strategies&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">slow_operation</span><span class="p">(</span><span class="n">operation_id</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🐌 Operation </span><span class="si">{</span><span class="n">operation_id</span><span class="si">}</span><span class="s2">: Starting (</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Operation </span><span class="si">{</span><span class="n">operation_id</span><span class="si">}</span><span class="s2">: Completed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Result from </span><span class="si">{</span><span class="n">operation_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Timeout Handling Strategies ===&quot;</span><span class="p">)</span>

    <span class="c1"># Strategy 1: Individual operation timeout</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🧪 Individual operation timeout:&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
            <span class="n">slow_operation</span><span class="p">(</span><span class="s2">&quot;Slow1&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mf">2.0</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⏰ Operation timed out&quot;</span><span class="p">)</span>

    <span class="c1"># Strategy 2: Partial completion with timeout</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🧪 Partial completion with timeout:&quot;</span><span class="p">)</span>
    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">slow_operation</span><span class="p">(</span><span class="s2">&quot;Op1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>    <span class="c1"># Will complete</span>
        <span class="n">slow_operation</span><span class="p">(</span><span class="s2">&quot;Op2&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>    <span class="c1"># Will complete  </span>
        <span class="n">slow_operation</span><span class="p">(</span><span class="s2">&quot;Op3&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>    <span class="c1"># Will timeout</span>
        <span class="n">slow_operation</span><span class="p">(</span><span class="s2">&quot;Op4&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>    <span class="c1"># Will timeout</span>
    <span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">completed</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
            <span class="n">operations</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
            <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">ALL_COMPLETED</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📊 Completed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">completed</span><span class="p">)</span><span class="si">}</span><span class="s2">, Pending: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Process completed tasks</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">completed</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">task</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Completed: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Cancel pending tasks</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">pending</span><span class="p">:</span>
            <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="c1"># Wait for cancellation to complete</span>
        <span class="k">if</span> <span class="n">pending</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Unexpected error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_resilient_patterns</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows patterns for building resilient async applications&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">unreliable_service_call</span><span class="p">(</span><span class="n">call_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulates an unreliable external service&quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">:</span>  <span class="c1"># 70% failure rate</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Service call </span><span class="si">{</span><span class="n">call_id</span><span class="si">}</span><span class="s2"> failed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Service result </span><span class="si">{</span><span class="n">call_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">retry_with_backoff</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">base_delay</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retry an operation with exponential backoff&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">operation</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_retries</span><span class="p">:</span>
                    <span class="k">raise</span>  <span class="c1"># Final attempt failed</span>

                <span class="n">delay</span> <span class="o">=</span> <span class="n">base_delay</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span>  <span class="c1"># Exponential backoff</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠️  Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Retrying in </span><span class="si">{</span><span class="n">delay</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s...&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">circuit_breaker_call</span><span class="p">(</span><span class="n">service_func</span><span class="p">,</span> <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simple circuit breaker pattern&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">circuit_breaker_call</span><span class="p">,</span> <span class="s1">&#39;failures&#39;</span><span class="p">):</span>
            <span class="n">circuit_breaker_call</span><span class="o">.</span><span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">circuit_breaker_call</span><span class="o">.</span><span class="n">last_failure_time</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Check if circuit is open</span>
        <span class="k">if</span> <span class="n">circuit_breaker_call</span><span class="o">.</span><span class="n">failures</span> <span class="o">&gt;=</span> <span class="n">failure_threshold</span><span class="p">:</span>
            <span class="n">time_since_failure</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">circuit_breaker_call</span><span class="o">.</span><span class="n">last_failure_time</span>
            <span class="k">if</span> <span class="n">time_since_failure</span> <span class="o">&lt;</span> <span class="mf">5.0</span><span class="p">:</span>  <span class="c1"># 5 second timeout</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Circuit breaker is OPEN - service unavailable&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Reset circuit breaker</span>
                <span class="n">circuit_breaker_call</span><span class="o">.</span><span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">service_func</span><span class="p">()</span>
            <span class="n">circuit_breaker_call</span><span class="o">.</span><span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Reset on success</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">circuit_breaker_call</span><span class="o">.</span><span class="n">failures</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">circuit_breaker_call</span><span class="o">.</span><span class="n">last_failure_time</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">raise</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Resilient Service Calls ===&quot;</span><span class="p">)</span>

    <span class="c1"># Test retry pattern</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔄 Testing retry with backoff:&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">retry_with_backoff</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">unreliable_service_call</span><span class="p">(</span><span class="s2">&quot;RetryTest&quot;</span><span class="p">),</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Retry succeeded: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ All retries failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Test circuit breaker pattern</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔌 Testing circuit breaker:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">circuit_breaker_call</span><span class="p">(</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="n">unreliable_service_call</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CB-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Call </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Call </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">demonstrate_exception_propagation</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_task_exception_handling</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_timeout_handling</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_resilient_patterns</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<h2 id="performance-optimization-and-best-practices">Performance Optimization and Best Practices<a class="headerlink" href="#performance-optimization-and-best-practices" title="Permanent link">&para;</a></h2>
<p>Understanding asyncio performance characteristics helps you build efficient applications.</p>
<h3 id="connection-pooling-and-resource-management">Connection Pooling and Resource Management<a class="headerlink" href="#connection-pooling-and-resource-management" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">HighPerformanceHTTPClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrates proper resource management and connection pooling&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_connections</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">requests_per_host</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="c1"># Configure connection pooling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connector</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">max_connections</span><span class="p">,</span>           <span class="c1"># Total connection pool size</span>
            <span class="n">limit_per_host</span><span class="o">=</span><span class="n">requests_per_host</span><span class="p">,</span> <span class="c1"># Connections per host</span>
            <span class="n">keepalive_timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>            <span class="c1"># Keep connections alive</span>
            <span class="n">enable_cleanup_closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>      <span class="c1"># Clean up closed connections</span>
            <span class="n">use_dns_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>              <span class="c1"># Cache DNS lookups</span>
            <span class="n">ttl_dns_cache</span><span class="o">=</span><span class="mi">300</span>                <span class="c1"># DNS cache TTL</span>
        <span class="p">)</span>

        <span class="c1"># Configure timeouts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>      <span class="c1"># Total request timeout</span>
            <span class="n">connect</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>     <span class="c1"># Connection timeout</span>
            <span class="n">sock_read</span><span class="o">=</span><span class="mi">10</span>   <span class="c1"># Socket read timeout</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_stats</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;reused&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span>
            <span class="n">connector</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connector</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make GET request with connection reuse&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="c1"># Track connection reuse</span>
            <span class="n">connection_key</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">key</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_seen_connections&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">connection_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seen_connections</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection_stats</span><span class="p">[</span><span class="s2">&quot;reused&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection_stats</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_seen_connections</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">connection_key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_seen_connections</span> <span class="o">=</span> <span class="p">{</span><span class="n">connection_key</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_stats</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get performance statistics&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;total_requests&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_count</span><span class="p">,</span>
            <span class="s2">&quot;connections_created&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_stats</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span>
            <span class="s2">&quot;connections_reused&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_stats</span><span class="p">[</span><span class="s2">&quot;reused&quot;</span><span class="p">],</span>
            <span class="s2">&quot;reuse_rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_stats</span><span class="p">[</span><span class="s2">&quot;reused&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_count</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="p">}</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_connection_pooling</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows the benefits of connection pooling&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Connection Pooling Performance ===&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_with_pooling</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test with proper connection pooling&quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">HighPerformanceHTTPClient</span><span class="p">(</span><span class="n">max_connections</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># Make many requests to the same host</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;https://httpbin.org/get?id=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_stats</span><span class="p">()</span>

            <span class="n">successful</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)])</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                <span class="s2">&quot;successful_requests&quot;</span><span class="p">:</span> <span class="n">successful</span><span class="p">,</span>
                <span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="n">stats</span>
            <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_without_pooling</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test without connection pooling (creates new session each time)&quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">single_request</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                    <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">single_request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;https://httpbin.org/get?id=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">successful</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)])</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
            <span class="s2">&quot;successful_requests&quot;</span><span class="p">:</span> <span class="n">successful</span><span class="p">,</span>
            <span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="s2">&quot;No pooling - each request creates new connection&quot;</span><span class="p">}</span>
        <span class="p">}</span>

    <span class="c1"># Test both approaches</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔄 Testing WITH connection pooling:&quot;</span><span class="p">)</span>
    <span class="n">pooled_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">test_with_pooling</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔄 Testing WITHOUT connection pooling:&quot;</span><span class="p">)</span>
    <span class="n">no_pool_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">test_without_pooling</span><span class="p">()</span>

    <span class="c1"># Compare results</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 Performance Comparison:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  With pooling:    </span><span class="si">{</span><span class="n">pooled_results</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s for </span><span class="si">{</span><span class="n">pooled_results</span><span class="p">[</span><span class="s1">&#39;successful_requests&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> requests&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Without pooling: </span><span class="si">{</span><span class="n">no_pool_results</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s for </span><span class="si">{</span><span class="n">no_pool_results</span><span class="p">[</span><span class="s1">&#39;successful_requests&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> requests&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Speedup: </span><span class="si">{</span><span class="n">no_pool_results</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pooled_results</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔌 Connection Statistics:&quot;</span><span class="p">)</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">pooled_results</span><span class="p">[</span><span class="s1">&#39;stats&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Connections created: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;connections_created&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Connections reused: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;connections_reused&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Reuse rate: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;reuse_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_batching_optimization</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows the performance benefits of batching operations&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_item</span><span class="p">(</span><span class="n">item_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate processing a single item&quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Simulate processing time</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Processed-</span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_batch</span><span class="p">(</span><span class="n">item_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate processing a batch of items (more efficient)&quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_ids</span><span class="p">))</span>  <span class="c1"># Batch processing is more efficient</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;BatchProcessed-</span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">item_id</span> <span class="ow">in</span> <span class="n">item_ids</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Batching vs Individual Processing ===&quot;</span><span class="p">)</span>

    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>  <span class="c1"># 20 items to process</span>

    <span class="c1"># Individual processing</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔄 Individual processing:&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">individual_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
        <span class="n">process_item</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">item_id</span> <span class="ow">in</span> <span class="n">items</span>
    <span class="p">])</span>
    <span class="n">individual_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="c1"># Batch processing</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔄 Batch processing:&quot;</span><span class="p">)</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">batches</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">)]</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">batch_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
        <span class="n">process_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span>
    <span class="p">])</span>
    <span class="c1"># Flatten results</span>
    <span class="n">batch_results_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batch_results</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
    <span class="n">batch_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 Batching Performance:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Individual: </span><span class="si">{</span><span class="n">individual_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">individual_results</span><span class="p">)</span><span class="si">}</span><span class="s2"> items&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Batched:    </span><span class="si">{</span><span class="n">batch_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batch_results_flat</span><span class="p">)</span><span class="si">}</span><span class="s2"> items&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Speedup: </span><span class="si">{</span><span class="n">individual_time</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">batch_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_memory_efficient_streaming</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows memory-efficient processing of large datasets&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">generate_large_dataset</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate a large data source&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>  <span class="c1"># Large dataset</span>
            <span class="k">yield</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;item_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">}</span>
            <span class="c1"># Small delay to simulate real data source</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_streaming_data</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process data as it arrives (memory efficient)&quot;&quot;&quot;</span>
        <span class="n">processed_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_value</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">generate_large_dataset</span><span class="p">():</span>
            <span class="c1"># Process each item as it arrives</span>
            <span class="n">total_value</span> <span class="o">+=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
            <span class="n">processed_count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">processed_count</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📊 Processed </span><span class="si">{</span><span class="n">processed_count</span><span class="si">}</span><span class="s2"> items (streaming)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">processed_count</span><span class="p">,</span> <span class="s2">&quot;total_value&quot;</span><span class="p">:</span> <span class="n">total_value</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_batch_loaded_data</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load all data then process (memory intensive)&quot;&quot;&quot;</span>
        <span class="c1"># Load all data into memory</span>
        <span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">generate_large_dataset</span><span class="p">():</span>
            <span class="n">all_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;📊 Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> items into memory&quot;</span><span class="p">)</span>

        <span class="c1"># Process all data</span>
        <span class="n">total_value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_data</span><span class="p">),</span> <span class="s2">&quot;total_value&quot;</span><span class="p">:</span> <span class="n">total_value</span><span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Memory-Efficient Streaming ===&quot;</span><span class="p">)</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

    <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>

    <span class="c1"># Test streaming approach</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🌊 Streaming processing:&quot;</span><span class="p">)</span>
    <span class="n">memory_before</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>  <span class="c1"># MB</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">streaming_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">process_streaming_data</span><span class="p">()</span>

    <span class="n">streaming_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="n">memory_after</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>  <span class="c1"># MB</span>
    <span class="n">memory_used_streaming</span> <span class="o">=</span> <span class="n">memory_after</span> <span class="o">-</span> <span class="n">memory_before</span>

    <span class="c1"># Test batch loading approach</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📦 Batch loading processing:&quot;</span><span class="p">)</span>
    <span class="n">memory_before</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>  <span class="c1"># MB</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">batch_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">process_batch_loaded_data</span><span class="p">()</span>

    <span class="n">batch_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="n">memory_after</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>  <span class="c1"># MB</span>
    <span class="n">memory_used_batch</span> <span class="o">=</span> <span class="n">memory_after</span> <span class="o">-</span> <span class="n">memory_before</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 Memory and Performance Comparison:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Streaming: </span><span class="si">{</span><span class="n">streaming_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s, ~</span><span class="si">{</span><span class="n">memory_used_streaming</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB extra memory&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Batch:     </span><span class="si">{</span><span class="n">batch_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s, ~</span><span class="si">{</span><span class="n">memory_used_batch</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB extra memory&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Memory savings with streaming: </span><span class="si">{</span><span class="n">memory_used_batch</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">memory_used_streaming</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">demonstrate_connection_pooling</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_batching_optimization</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_memory_efficient_streaming</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<h2 id="common-pitfalls-and-solutions">Common Pitfalls and Solutions<a class="headerlink" href="#common-pitfalls-and-solutions" title="Permanent link">&para;</a></h2>
<p>Understanding common mistakes helps you write better asyncio code.</p>
<h3 id="blocking-the-event-loop">Blocking the Event Loop<a class="headerlink" href="#blocking-the-event-loop" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">concurrent.futures</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_blocking_problems</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows how blocking calls break asyncio&#39;s concurrency&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== The Blocking Problem ===&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">bad_concurrent_requests</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;❌ DON&#39;T DO THIS - blocking calls in async code&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🐌 Making &#39;concurrent&#39; requests with blocking library...&quot;</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># These look concurrent but actually run sequentially!</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="c1"># requests.get() is a blocking call that stops the entire event loop</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
                <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span>  <span class="c1"># We&#39;ll fix this in the good example</span>
                    <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;https://httpbin.org/delay/1&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🐌 &#39;Concurrent&#39; requests took: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">duration</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">truly_blocking_example</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;❌ What NOT to do - direct blocking calls&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🚫 Direct blocking calls (DON&#39;T DO THIS):&quot;</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># This completely blocks the event loop!</span>
        <span class="c1"># We&#39;ll simulate this with a CPU-intensive task</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">cpu_intensive_work</span><span class="p">():</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="n">total</span>

        <span class="c1"># This blocks everything</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cpu_intensive_work</span><span class="p">()</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🚫 Blocking operation took: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">duration</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">good_concurrent_requests</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;✅ DO THIS - proper async requests&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🚀 Making truly concurrent requests...&quot;</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;https://httpbin.org/delay/1&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

            <span class="c1"># Close responses</span>
            <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
                <span class="n">response</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🚀 Truly concurrent requests took: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">duration</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">good_cpu_intensive_work</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;✅ DO THIS - CPU work in executor&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚡ CPU work in executor:&quot;</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">cpu_intensive_work</span><span class="p">():</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="n">total</span>

        <span class="c1"># Run CPU work in thread pool</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="n">executor</span><span class="p">,</span> <span class="n">cpu_intensive_work</span><span class="p">)</span>

        <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚡ Non-blocking CPU work took: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">duration</span>

    <span class="c1"># Compare approaches</span>
    <span class="n">good_requests_time</span> <span class="o">=</span> <span class="k">await</span> <span class="n">good_concurrent_requests</span><span class="p">()</span>
    <span class="n">bad_requests_time</span> <span class="o">=</span> <span class="k">await</span> <span class="n">bad_concurrent_requests</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 Request Performance:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Speedup with proper async: </span><span class="si">{</span><span class="n">bad_requests_time</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">good_requests_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>

    <span class="n">blocking_time</span> <span class="o">=</span> <span class="k">await</span> <span class="n">truly_blocking_example</span><span class="p">()</span>
    <span class="n">nonblocking_time</span> <span class="o">=</span> <span class="k">await</span> <span class="n">good_cpu_intensive_work</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 CPU Work Performance:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Both approaches took similar time, but async version doesn&#39;t block the event loop&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_resource_leaks</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows resource leak problems and solutions&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Resource Management ===&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resource_leak_example</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;❌ Resource leak example&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🚨 Resource leak example (DON&#39;T DO THIS):&quot;</span><span class="p">)</span>

        <span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="c1"># Creating sessions but not closing them!</span>
            <span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span>
            <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/get&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Request </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: Status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Request </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: Error </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Sessions are never closed - RESOURCE LEAK!</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🚨 Sessions created but never closed - memory and connection leak!&quot;</span><span class="p">)</span>

        <span class="c1"># Clean up for demo (you shouldn&#39;t rely on this)</span>
        <span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">proper_resource_management</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;✅ Proper resource management&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Proper resource management:&quot;</span><span class="p">)</span>

        <span class="c1"># Method 1: Context manager (preferred)</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/get&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">response</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">responses</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Request </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: Status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">response</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Session automatically closed by context manager</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Session automatically closed by context manager&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">manual_cleanup_example</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;✅ Manual cleanup when context manager not available&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Manual cleanup example:&quot;</span><span class="p">)</span>

        <span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/get&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Manual cleanup: Status </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Always close in finally block</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Session manually closed in finally block&quot;</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">resource_leak_example</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">proper_resource_management</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">manual_cleanup_example</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_deadlock_avoidance</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows how to avoid deadlocks in async code&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Deadlock Avoidance ===&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">deadlock_example</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;⚠️ Potential deadlock scenario&quot;&quot;&quot;</span>
        <span class="n">lock1</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="n">lock2</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">task_a</span><span class="p">():</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">lock1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔒 Task A: Acquired lock1&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

                <span class="c1"># Try to acquire lock2 while holding lock1</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔒 Task A: Trying to acquire lock2...&quot;</span><span class="p">)</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">lock2</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔒 Task A: Acquired lock2&quot;</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">task_b</span><span class="p">():</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">lock2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔒 Task B: Acquired lock2&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

                <span class="c1"># Try to acquire lock1 while holding lock2</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔒 Task B: Trying to acquire lock1...&quot;</span><span class="p">)</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">lock1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔒 Task B: Acquired lock1&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⚠️ Potential deadlock scenario (tasks acquire locks in different order):&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># This might deadlock!</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
                <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">task_a</span><span class="p">(),</span> <span class="n">task_b</span><span class="p">()),</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mf">1.0</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ No deadlock occurred&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Deadlock detected! Tasks timed out&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">deadlock_solution</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;✅ Deadlock-free solution&quot;&quot;&quot;</span>
        <span class="n">lock1</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="n">lock2</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">safe_task_a</span><span class="p">():</span>
            <span class="c1"># Always acquire locks in the same order</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">lock1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Safe Task A: Acquired lock1&quot;</span><span class="p">)</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">lock2</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Safe Task A: Acquired lock2&quot;</span><span class="p">)</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">safe_task_b</span><span class="p">():</span>
            <span class="c1"># Same order as task A</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">lock1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Safe Task B: Acquired lock1&quot;</span><span class="p">)</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">lock2</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Safe Task B: Acquired lock2&quot;</span><span class="p">)</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Deadlock-free solution (consistent lock ordering):&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">safe_task_a</span><span class="p">(),</span> <span class="n">safe_task_b</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ All tasks completed successfully&quot;</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">deadlock_example</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">deadlock_solution</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_forgotten_await</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shows the consequences of forgetting await&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Forgotten await Problems ===&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">important_async_function</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;An async function that should be awaited&quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Important result&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">forgot_await_example</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;❌ Forgetting to await&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Forgetting to await:&quot;</span><span class="p">)</span>

        <span class="c1"># This doesn&#39;t actually run the function!</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">important_async_function</span><span class="p">()</span>  <span class="c1"># Returns coroutine object</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Result type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Result value: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ⚠️ The function never actually executed!&quot;</span><span class="p">)</span>

        <span class="c1"># Clean up to prevent warning</span>
        <span class="n">result</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">correct_await_example</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;✅ Proper await usage&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Proper await usage:&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">important_async_function</span><span class="p">()</span>  <span class="c1"># Actually runs the function</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✅ Function executed and returned result&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">loop_await_mistake</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;❌ Common mistake in loops&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ Forgetting await in loops:&quot;</span><span class="p">)</span>

        <span class="n">coroutines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="c1"># This creates coroutine objects but doesn&#39;t run them</span>
            <span class="n">coro</span> <span class="o">=</span> <span class="n">important_async_function</span><span class="p">()</span>
            <span class="n">coroutines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coro</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">coroutines</span><span class="p">)</span><span class="si">}</span><span class="s2"> coroutine objects&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ⚠️ None of them have executed yet!&quot;</span><span class="p">)</span>

        <span class="c1"># Clean up</span>
        <span class="k">for</span> <span class="n">coro</span> <span class="ow">in</span> <span class="n">coroutines</span><span class="p">:</span>
            <span class="n">coro</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">correct_loop_example</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;✅ Correct loop with await&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Correct loop with concurrent execution:&quot;</span><span class="p">)</span>

        <span class="c1"># Create tasks that start immediately</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">important_async_function</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Results: </span><span class="si">{</span><span class="n">results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✅ All functions executed concurrently&quot;</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">forgot_await_example</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">correct_await_example</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">loop_await_mistake</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">correct_loop_example</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">demonstrate_blocking_problems</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_resource_leaks</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_deadlock_avoidance</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">demonstrate_forgotten_await</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<h2 id="real-world-application-patterns">Real-World Application Patterns<a class="headerlink" href="#real-world-application-patterns" title="Permanent link">&para;</a></h2>
<p>Here are comprehensive patterns for building production asyncio applications:</p>
<h3 id="web-scraping-with-rate-limiting">Web Scraping with Rate Limiting<a class="headerlink" href="#web-scraping-with-rate-limiting" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urljoin</span><span class="p">,</span> <span class="n">urlparse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">class</span><span class="w"> </span><span class="nc">IntelligentWebScraper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Production-ready web scraper with rate limiting and error handling&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">max_concurrent</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_delay</span> <span class="o">=</span> <span class="n">base_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrent</span> <span class="o">=</span> <span class="n">max_concurrent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semaphore</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">max_concurrent</span><span class="p">)</span>

        <span class="c1"># Statistics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;requests_made&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;successful_requests&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;failed_requests&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;retries&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;rate_limited&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>

        <span class="c1"># Rate limiting per domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_request_time</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain_delays</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span>
            <span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">limit_per_host</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">keepalive_timeout</span><span class="o">=</span><span class="mi">30</span>
        <span class="p">)</span>

        <span class="n">timeout</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span>
            <span class="n">connector</span><span class="o">=</span><span class="n">connector</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (compatible; AsyncScraper/1.0)&#39;</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">smart_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement intelligent rate limiting per domain&quot;&quot;&quot;</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span>

        <span class="c1"># Get domain-specific delay</span>
        <span class="n">domain_delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_delays</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_delay</span><span class="p">)</span>

        <span class="c1"># Check if we need to wait</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_request_time</span><span class="p">:</span>
            <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_request_time</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">elapsed</span> <span class="o">&lt;</span> <span class="n">domain_delay</span><span class="p">:</span>
                <span class="n">wait_time</span> <span class="o">=</span> <span class="n">domain_delay</span> <span class="o">-</span> <span class="n">elapsed</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏰ Rate limiting: waiting </span><span class="si">{</span><span class="n">wait_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s for </span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;rate_limited&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_request_time</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_with_retries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch URL with intelligent retry logic&quot;&quot;&quot;</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span>

        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">semaphore</span><span class="p">:</span>  <span class="c1"># Limit concurrent requests</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">smart_delay</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>  <span class="c1"># Rate limiting</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;requests_made&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                            <span class="n">content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;successful_requests&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">return</span> <span class="p">{</span>
                                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span>
                                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                                <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
                            <span class="p">}</span>

                        <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>  <span class="c1"># Rate limited</span>
                            <span class="c1"># Increase delay for this domain</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">domain_delays</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_delays</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_delay</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
                            <span class="k">raise</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientResponseError</span><span class="p">(</span>
                                <span class="n">request_info</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request_info</span><span class="p">,</span>
                                <span class="n">history</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">history</span><span class="p">,</span>
                                <span class="n">status</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Rate limited&quot;</span>
                            <span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientResponseError</span><span class="p">(</span>
                                <span class="n">request_info</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request_info</span><span class="p">,</span>
                                <span class="n">history</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">history</span><span class="p">,</span>
                                <span class="n">status</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status</span>
                            <span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;failed_requests&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Failed to fetch </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> attempts: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>

                <span class="c1"># Exponential backoff</span>
                <span class="n">retry_delay</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠️ Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> failed for </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Retrying in </span><span class="si">{</span><span class="n">retry_delay</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;retries&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_delay</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_intelligent_scraping</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrates intelligent web scraping&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Intelligent Web Scraping ===&quot;</span><span class="p">)</span>

    <span class="c1"># URLs to scrape</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;https://httpbin.org/delay/1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://httpbin.org/status/200&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://httpbin.org/json&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://httpbin.org/headers&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://httpbin.org/user-agent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://httpbin.org/delay/2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;https://httpbin.org/status/429&quot;</span><span class="p">,</span>  <span class="c1"># Rate limited response</span>
        <span class="s2">&quot;https://httpbin.org/html&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">IntelligentWebScraper</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_concurrent</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">as</span> <span class="n">scraper</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Scrape all URLs concurrently with rate limiting</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">scraper</span><span class="o">.</span><span class="n">fetch_with_retries</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

        <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="c1"># Analyze results</span>
        <span class="n">successful</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">failed</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 Scraping Results:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Duration: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Successful: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">successful</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Failed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total requests made: </span><span class="si">{</span><span class="n">scraper</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;requests_made&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Rate limited events: </span><span class="si">{</span><span class="n">scraper</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;rate_limited&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Retries performed: </span><span class="si">{</span><span class="n">scraper</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;retries&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Show successful results</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">successful</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>  <span class="c1"># Show first 3</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✅ </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> chars)&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">demonstrate_intelligent_scraping</span><span class="p">())</span>
</code></pre></div>
<p>This regenerated asyncio cheatsheet provides a comprehensive, deep-dive exploration of asyncio concepts with working examples and practical patterns. It maintains the focus on explaining how things work rather than just listing tips, making it an excellent learning and reference resource.</p>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../blog/archive/2025/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 2025">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                2025
              </div>
            </div>
          </a>
        
        
          
          <a href="../Dimensional_Modeling_Cheatseet/" class="md-footer__link md-footer__link--next" aria-label="Next: Dimensional Data Modeling Cheatsheet">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Dimensional Data Modeling Cheatsheet
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.path", "navigation.indexes", "navigation.footer", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
        <script src="https://d3js.org/d3.v7.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>